# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å API

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã

### 1. –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π
- ‚úÖ –í—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (`$1`, `$2`, ...)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö

**–ü—Ä–∏–º–µ—Ä:**
```javascript
// ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ
await pool.query('SELECT * FROM products WHERE id = $1', [productId]);

// ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ (–æ–ø–∞—Å–Ω–æ!)
await pool.query(`SELECT * FROM products WHERE id = ${productId}`);
```

### 2. –ó–∞—â–∏—Ç–∞ API –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

#### –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏):
- `GET /api/products` - —Ç–æ–ª—å–∫–æ **–¥–æ—Å—Ç—É–ø–Ω—ã–µ** —Ç–æ–≤–∞—Ä—ã
- `GET /api/products/:id` - —Ç–æ–ª—å–∫–æ **–¥–æ—Å—Ç—É–ø–Ω—ã–µ** —Ç–æ–≤–∞—Ä—ã  
- `GET /api/product-by-slug/:slug` - —Ç–æ–ª—å–∫–æ **–¥–æ—Å—Ç—É–ø–Ω—ã–µ** —Ç–æ–≤–∞—Ä—ã
- `POST /api/order` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (—Å rate limiting)

**–í–∞–∂–Ω–æ:** –ü—É–±–ª–∏—á–Ω—ã–µ API –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å `available = true`. –ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏ —Å–ª—É–∂–µ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (supplier_link, supplier_notes) —Å–∫—Ä—ã—Ç—ã.

#### –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (—Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏):
- `GET /api/admin/*` - –≤—Å–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `POST /api/upload` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

### 3. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST `/api/login` —Å `username` –∏ `password`
2. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `sessionId`
3. –ö–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `sessionId` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `x-session-id` –¥–ª—è –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. –°–µ—Å—Å–∏—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ 24 —á–∞—Å–∞

**–ü—Ä–∏–º–µ—Ä:**
```javascript
// –õ–æ–≥–∏–Ω
const response = await fetch('/api/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ username: 'admin', password: 'password' })
});
const { sessionId } = await response.json();

// –ó–∞—â–∏—â–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
const products = await fetch('/api/admin/products?show_all=true', {
  headers: { 'x-session-id': sessionId }
});
```

### 4. Rate Limiting

- **–ü—É–±–ª–∏—á–Ω—ã–µ API:** 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 15 –º–∏–Ω—É—Ç
- **–õ–æ–≥–∏–Ω:** 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ 15 –º–∏–Ω—É—Ç (–∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞)
- **–ó–∞–∫–∞–∑—ã:** 3 –∑–∞–∫–∞–∑–∞ –≤ –º–∏–Ω—É—Ç—É (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)

### 5. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ (–∑–∞—â–∏—Ç–∞ –æ—Ç XSS)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è ID (—Ç–æ–ª—å–∫–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤, email
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫

## üîí –ß—Ç–æ –∑–∞—â–∏—â–µ–Ω–æ

### –ü—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º):
- ‚úÖ –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤

### –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤):
- üîí –í—Å–µ —Ç–æ–≤–∞—Ä—ã (–≤–∫–ª—é—á–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ)
- üîí –°–ª—É–∂–µ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (supplier_link, supplier_notes)
- üîí –ó–∞–∫–∞–∑—ã
- üîí –ê—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã
- üîí –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
- üîí –õ–æ–≥–∏—Å—Ç–∏–∫–∞

## ‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–∞—Ä–æ–ª–µ–π –∏ sessionId
2. ‚úÖ **–°–µ—Å—Å–∏–∏ –≤ –ë–î** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ! –°–µ—Å—Å–∏–∏ —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL –≤–º–µ—Å—Ç–æ –ø–∞–º—è—Ç–∏
3. **JWT —Ç–æ–∫–µ–Ω—ã** - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ sessionId (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. **Helmet.js** - –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
5. **CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - –æ–≥—Ä–∞–Ω–∏—á—å—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
7. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

## üö® –í–∞–∂–Ω–æ

**–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ sessionId –≤ URL!** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ HTTP.

```javascript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
headers: { 'x-session-id': sessionId }

// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
GET /api/admin/products?sessionId=abc123
```

