<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0b0b26;
            color: #fff;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            color: #60a5fa;
            margin-bottom: 30px;
        }
        .test-section {
            background: rgba(30, 39, 66, 0.6);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid rgba(96, 165, 250, 0.3);
        }
        .test-section h2 {
            color: #a78bfa;
            margin-top: 0;
            font-size: 1.2rem;
        }
        button {
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .info {
            background: rgba(59, 130, 246, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #3b82f6;
        }
        .code {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 10px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫</h1>
    
    <div class="test-section">
        <h2>1. –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h2>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ showNotification()</p>
        <button onclick="testNotification('error')">–ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É</button>
        <button onclick="testNotification('warning')">–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</button>
        <button onclick="testNotification('info')">–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
        <button onclick="testNotification('success')">–ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö</button>
        <div class="info">
            <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è —Ü–≤–µ—Ç–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π.
        </div>
    </div>

    <div class="test-section">
        <h2>2. –¢–µ—Å—Ç —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫</h2>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>
        <button onclick="testNetworkError()">–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–µ–≤—É—é –æ—à–∏–±–∫—É</button>
        <button onclick="testTimeoutError()">–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–π–º–∞—É—Ç</button>
        <div class="info">
            <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å–µ—Ç–∏.
        </div>
    </div>

    <div class="test-section">
        <h2>3. –¢–µ—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON</h2>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ safeJsonParse()</p>
        <button onclick="testSafeJsonParse()">–¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞</button>
        <div class="info">
            <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ/–Ω–µ—É—Å–ø–µ—à–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞.
        </div>
    </div>

    <div class="test-section">
        <h2>4. –¢–µ—Å—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ API –∑–∞–ø—Ä–æ—Å–∞</h2>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ</p>
        <button onclick="testRealRequest()">–ó–∞–ø—Ä–æ—Å –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É</button>
        <button onclick="testRealRequestSuccess()">–ó–∞–ø—Ä–æ—Å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É</button>
        <div class="info">
            <strong>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –ü—Ä–∏ –æ—à–∏–±–∫–µ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –ø—Ä–∏ —É—Å–ø–µ—Ö–µ - –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Å–æ–ª–∏.
        </div>
    </div>

    <div class="test-section">
        <h2>5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–æ–ª–∏</h2>
        <p>–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏</p>
        <div class="code">
            –í—Å–µ –æ—à–∏–±–∫–∏ –¥–æ–ª–∂–Ω—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
        </div>
    </div>

    <script src="/js/utils.js"></script>
    <script>
        function testNotification(type) {
            const messages = {
                error: '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ',
                warning: '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ',
                info: '–≠—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
                success: '–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!'
            };
            
            if (typeof showNotification === 'function') {
                showNotification(messages[type], type);
                console.log(`‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ "${type}" –ø–æ–∫–∞–∑–∞–Ω–æ`);
            } else {
                alert('–§—É–Ω–∫—Ü–∏—è showNotification –Ω–µ –Ω–∞–π–¥–µ–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ utils.js –∑–∞–≥—Ä—É–∂–µ–Ω.');
            }
        }

        function testNetworkError() {
            const error = new TypeError('Failed to fetch');
            error.name = 'NetworkError';
            
            if (typeof handleFetchError === 'function') {
                const message = handleFetchError(error);
                if (typeof showNotification === 'function') {
                    showNotification(message, 'error');
                } else {
                    alert(message);
                }
                console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤–æ–π –æ—à–∏–±–∫–∏:', message);
            } else {
                alert('–§—É–Ω–∫—Ü–∏—è handleFetchError –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
        }

        function testTimeoutError() {
            const error = new Error('Request timeout');
            error.name = 'TimeoutError';
            
            if (typeof handleFetchError === 'function') {
                const message = handleFetchError(error);
                if (typeof showNotification === 'function') {
                    showNotification(message, 'error');
                } else {
                    alert(message);
                }
                console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞:', message);
            } else {
                alert('–§—É–Ω–∫—Ü–∏—è handleFetchError –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
        }

        async function testSafeJsonParse() {
            // –¢–µ—Å—Ç —Å –≤–∞–ª–∏–¥–Ω—ã–º JSON
            const validResponse = {
                ok: true,
                json: async () => ({ success: true, data: 'test' })
            };
            
            if (typeof safeJsonParse === 'function') {
                try {
                    const result = await safeJsonParse(validResponse);
                    console.log('‚úÖ –í–∞–ª–∏–¥–Ω—ã–π JSON —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω:', result);
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON:', error);
                }
            } else {
                console.error('–§—É–Ω–∫—Ü–∏—è safeJsonParse –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
        }

        async function testRealRequest() {
            try {
                const response = await fetch('/api/nonexistent-endpoint');
                
                if (typeof safeJsonParse === 'function') {
                    const result = await safeJsonParse(response);
                    if (typeof showNotification === 'function') {
                        showNotification(result.error || '–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞', 'error');
                    } else {
                        alert(result.error || '–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞');
                    }
                    console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∑–∞–ø—Ä–æ—Å–∞:', result);
                } else {
                    const result = await response.json();
                    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
                }
            } catch (error) {
                if (typeof handleFetchError === 'function') {
                    const message = handleFetchError(error);
                    if (typeof showNotification === 'function') {
                        showNotification(message, 'error');
                    } else {
                        alert(message);
                    }
                    console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤–æ–π –æ—à–∏–±–∫–∏:', message);
                } else {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    alert('–û—à–∏–±–∫–∞: ' + error.message);
                }
            }
        }

        async function testRealRequestSuccess() {
            try {
                const response = await fetch('/api/products?limit=1');
                
                if (typeof safeJsonParse === 'function') {
                    const result = await safeJsonParse(response);
                    console.log('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å:', result);
                    if (typeof showNotification === 'function') {
                        showNotification('–ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.', 'success');
                    }
                } else {
                    const result = await response.json();
                    console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', result);
                }
            } catch (error) {
                if (typeof handleFetchError === 'function') {
                    const message = handleFetchError(error);
                    if (typeof showNotification === 'function') {
                        showNotification(message, 'error');
                    }
                } else {
                    console.error('–û—à–∏–±–∫–∞:', error);
                }
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', () => {
            const functions = ['showNotification', 'handleFetchError', 'safeJsonParse'];
            const missing = functions.filter(fn => typeof window[fn] !== 'function');
            
            if (missing.length > 0) {
                console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏:', missing);
                alert('–í–Ω–∏–º–∞–Ω–∏–µ! –ù–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.');
            } else {
                console.log('‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            }
        });
    </script>
</body>
</html>
